#!/bin/bash
# GitHub Repository Helper
# Creates private GitHub repos for AI projects
# Usage: github-repo [project-name]

set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

GITHUB_USERNAME="PirateUnderAPalm"

# Check if gh CLI is installed
if ! command -v gh &> /dev/null; then
    echo -e "${RED}GitHub CLI (gh) not found${NC}"
    echo ""
    echo "This script requires GitHub CLI for creating repos."
    echo ""
    echo "Install it with:"
    echo "  curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg"
    echo "  echo \"deb [arch=\$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null"
    echo "  sudo apt update"
    echo "  sudo apt install gh"
    echo ""
    echo "Then authenticate:"
    echo "  gh auth login"
    echo ""
    echo "ALTERNATIVE: Create repos manually at https://github.com/new"
    exit 1
fi

# Check if authenticated
if ! gh auth status &> /dev/null; then
    echo -e "${RED}Not authenticated with GitHub${NC}"
    echo "Run: gh auth login"
    exit 1
fi

# Get project name
if [ -z "$1" ]; then
    # Try to infer from current directory
    if [ -f "claude.md" ] || [ -f "gemini.md" ]; then
        PROJECT_NAME=$(basename "$(pwd)")
        echo -e "${BLUE}Detected project: $PROJECT_NAME${NC}"
    else
        echo -e "${RED}Error: No project name provided${NC}"
        echo "Usage: github-repo <project-name>"
        echo "Or run from a project directory"
        exit 1
    fi
else
    PROJECT_NAME="$1"
fi

echo -e "${YELLOW}Creating private GitHub repo for: $PROJECT_NAME${NC}"
echo ""

# Confirm
read -p "Repository will be PRIVATE. Continue? (y/N): " CONFIRM
if [[ ! "$CONFIRM" =~ ^[Yy]$ ]]; then
    echo "Cancelled"
    exit 0
fi

# Create the repo
echo -e "${BLUE}Creating repository...${NC}"
gh repo create "$PROJECT_NAME" --private --source=. --remote=origin

echo -e "${GREEN}✓ Repository created: https://github.com/$GITHUB_USERNAME/$PROJECT_NAME${NC}"

# Push current branch
CURRENT_BRANCH=$(git branch --show-current)
echo -e "${BLUE}Pushing to GitHub...${NC}"
git push -u origin "$CURRENT_BRANCH"

echo -e "${GREEN}✓ Code pushed to GitHub${NC}"
echo ""
echo "Repository: https://github.com/$GITHUB_USERNAME/$PROJECT_NAME"
echo "Visibility: Private"
echo ""
echo "To make it public later:"
echo "  gh repo edit $PROJECT_NAME --visibility public"
echo ""
